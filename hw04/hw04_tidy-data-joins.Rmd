---
title: 'Homework 04: Tidy data and joins'
author: "Amanda Cheung"
output: github_document
---

Putting my data wrangling skills to the test!

#### Gapminder and tidyveryse

Load gapminder and tidyverse.

```{r}
suppressPackageStartupMessages(library(gapminder))
suppressPackageStartupMessages(library(tidyverse))
```

## General data reshaping and relationship to aggregation

**Problem:** You have data in one “shape”, but you wish it were in another...

**Solution:** Reshape your data! Use `gather()` and `spread()` from `tidyr` for simple reshaping!

## Activity 1: `tidyr` cheatsheet

A minimal cheatsheet. Check out the [R studio version](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf), for a more comprehensive one.

### Main functions: `gather()` and `spread()`

| `tidyr` function |             action             |
|------------------|--------------------------------|
| `gather()`       | long format :arrow_up_down:    |
| `spread()`       | wide format :left_right_arrow: |

### Example data

```{r results= 'asis'}
student <- c('A', 'B', 'C')
biology <- c(88, 90, 75)
chemistry <- c(95, 85, 90)
french <- c(83, 77, 85) 

ex.data <- data.frame(student, biology, chemistry, french) 

knitr::kable(ex.data)
```


### `gather()`

Gather columns into rows.

![](ex_gather.png)

```{r results= 'asis'}
knitr::kable(ex.data %>%
               gather(key=subject, value=grade, biology:french))

## Alternative ways to call gather()
## gather(subject, grade, biology:french)
## gather(subject, grade, -c(student))
## gather(subject, grade, biology, chemistry, french)
```


### `spread()`

Spread rows into columns.

![](ex_spread.png)

```{r results= 'asis'}
knitr::kable(ex.data %>%
               gather(key=subject, value=grade, biology:french) %>% 
               spread(key=subject, value=grade))
```


## Activity 2: Exploring life expectancy

### Tibble: One row per year and columns for life expectancy for two or more countries

```{r results= 'asis'}
lifeExp.tbl <- gapminder %>%
  filter(country %in% c('Australia', 'Canada', 'Denmark')) %>% 
  select(year, country, lifeExp) %>% 
  spread(country, lifeExp)

knitr::kable(lifeExp.tbl)
```

### Scatterplot: Life expectancy for one country against that of another using the new data shape created above

```{r}
ggplot(lifeExp.tbl, aes(x=Canada, y=Australia)) + 
  geom_point(aes(colour=year)) +
  theme_bw() +
  labs(title='Canada vs. Australia Life Expectancy Trends') +
  scale_color_continuous("Year") +
  theme(plot.title=element_text(hjust=0.5))
```

```{r}
ggplot(lifeExp.tbl, aes(x=Canada, y=Denmark)) + 
  geom_point(aes(colour=year)) +
  theme_bw() +
  labs(title='Canada vs. Denmark Life Expectancy Trends') +
  scale_color_continuous("Year") +
  theme(plot.title=element_text(hjust=0.5))
```

```{r}
ggplot(lifeExp.tbl, aes(x=Australia, y=Denmark)) + 
  geom_point(aes(colour=year)) +
  theme_bw() +
  labs(title='Australia vs. Denmark Life Expectancy Trends') +
  scale_color_continuous("Year") +
  theme(plot.title=element_text(hjust=0.5))
```

## Activity 3: Maximum life expectancy

### Tibble: Maximum life expectancy for all possible combinations of continent and year. One row per year and one variable for each continent.

```{r results= 'asis'}
maxlifeExp.tbl <- gapminder %>%
  group_by(year, continent) %>%
  summarize(maxlifeExp = max(lifeExp)) %>%
  spread(continent, maxlifeExp) %>%
  arrange(year)

knitr::kable(maxlifeExp.tbl)
```

### Plot???


## Activity 4: 

```{r results= 'asis'}
europe.tbl <- gapminder %>%
  filter(continent == "Europe") %>%
  select(year, country, lifeExp) %>%
  group_by(year) %>%
  filter(min_rank(desc(lifeExp)) < 2 | min_rank(lifeExp) < 2) %>% 
  arrange(year) %>%
  spread(country, lifeExp)

knitr::kable(europe.tbl)
  
```

